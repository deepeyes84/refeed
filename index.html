<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>피크위크 매크로·수분 계산기 v1.0</title>
  <meta name="description" content="리피딩·디플리션·슈퍼컴펜세이션·대회 당일(스포츠모델/보디빌딩)용 매크로(g)와 수분·나트륨 권장량을 체중·체지방률로 산출하는 모바일 계산기" />
  <style>
    :root {
      --bg: #0b0c10;
      --panel: #121318;
      --ink: #e6e7ea;
      --muted: #9aa3b2;
      --accent: #6aa8ff;
      --accent-2: #7ef1c4;
      --danger: #ff6a7a;
      --ok: #7dffb0;
      --radius: 16px;
    }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Inter, Helvetica, Arial, Apple SD Gothic Neo, "Noto Sans KR", sans-serif;
      background: linear-gradient(180deg, #0b0c10 0%, #121318 100%);
      color: var(--ink);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .wrap { max-width: 760px; margin: 0 auto; padding: env(safe-area-inset-top) 16px 48px; }
    header { position: sticky; top: 0; z-index: 30; backdrop-filter: blur(10px); background: rgba(11,12,16,0.7); border-bottom: 1px solid rgba(255,255,255,0.06); }
    header .inner { max-width: 760px; margin: 0 auto; padding: 12px 16px; display: flex; align-items: center; gap: 12px; }
    header h1 { font-size: 18px; margin: 0; letter-spacing: .2px; font-weight: 700; }
    header small { color: var(--muted); }
    .panel { background: var(--panel); border: 1px solid rgba(255,255,255,0.06); border-radius: var(--radius); padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    .grid { display: grid; gap: 12px; }
    .grid.cols-2 { grid-template-columns: 1fr 1fr; }
    @media (max-width: 640px){ .grid.cols-2 { grid-template-columns: 1fr; } }
    label { font-size: 13px; color: var(--muted); display: flex; justify-content: space-between; align-items: center; gap: 8px; }
    input[type="number"], select { width: 100%; background: #0f1116; color: var(--ink); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 12px 12px; font-size: 16px; }
    input[type="range"] { width: 100%; }
    .row { display: grid; gap: 6px; }
    .kicker { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: .14em; }
    .note { color: var(--muted); font-size: 13px; line-height: 1.45; }
    .chip { display:inline-flex; align-items:center; gap:8px; background:#0f1116; border-radius:999px; padding:6px 10px; border:1px solid rgba(255,255,255,0.08); font-size:12px; color:var(--muted) }
    .out { display:flex; align-items:center; justify-content:space-between; gap:8px; background:#0d1016; border:1px solid rgba(255,255,255,.07); border-radius:14px; padding:10px 12px; }
    .out b { font-size: 16px; }
    .out small { color: var(--muted); }
    .warn { color: var(--danger); }
    .ok { color: var(--ok); }
    .btns { display:flex; gap:8px; flex-wrap: wrap; }
    button { background: #1b2230; color: var(--ink); border: 1px solid rgba(255,255,255,0.08); padding: 10px 12px; border-radius: 12px; font-size: 14px; font-weight: 600; }
    button.primary { background: linear-gradient(180deg, #1f4df0, #1743e0); border-color: transparent; }
    .section-title { display:flex; align-items:center; justify-content:space-between; margin: 8px 0 4px; }
    .pill { padding: 4px 8px; border-radius: 999px; border: 1px dashed rgba(255,255,255,.15); color: var(--muted); font-size: 12px; }
    .hr { height:1px; background:linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent); margin: 10px 0; }
    .footnote { font-size: 12px; color: var(--muted); }
    .flex { display:flex; gap: 10px; }
    .flexcol { display:flex; flex-direction:column; gap:10px; }
    .center { text-align:center; }
    .progress { width: 100%; height: 12px; background: #0f1116; border-radius: 999px; overflow: hidden; border: 1px solid rgba(255,255,255,.08); }
    .progress > span { display:block; height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); width: 0%; transition: width .3s ease; }
    .tiny { font-size: 11.5px; color: var(--muted); }
  </style>
</head>
<body>
  <header>
    <div class="inner">
      <h1>피크위크 매크로·수분 계산기</h1>
      <small class="chip">v1.0 · iPhone 최적화</small>
    </div>
  </header>
  <div class="wrap">
    <div class="panel grid">
      <div class="row">
        <div class="section-title"><div>
          <div class="kicker">1) 입력</div>
          <h3 style="margin:4px 0 0">체중·체지방률 및 모드</h3></div>
          <span class="pill">기준 단위: kg / %</span>
        </div>
        <div class="grid cols-2">
          <div class="row">
            <label>체중 (BW)<span id="bwLive">71.0 kg</span></label>
            <input id="bw" type="number" step="0.1" min="35" max="150" value="71.0" />
          </div>
          <div class="row">
            <label>체지방률 (BF%)<span id="bfLive">10.0%</span></label>
            <input id="bf" type="number" step="0.1" min="2" max="45" value="10.0" />
          </div>
        </div>
        <div class="grid cols-2">
          <div class="row">
            <label>모드 선택</label>
            <select id="mode">
              <option value="refeed">리피딩 (Refeed)</option>
              <option value="depletion">디플리션 (Depletion)</option>
              <option value="supercomp">슈퍼컴펜세이션 (Supercomp)</option>
              <option value="showday">대회 당일 (Show Day)</option>
            </select>
          </div>
          <div class="row" id="divisionWrap" style="display:none">
            <label>종목 (대회 당일)</label>
            <select id="division">
              <option value="sportsmodel">스포츠모델</option>
              <option value="bodybuilding">보디빌딩</option>
            </select>
          </div>
        </div>
        <div class="note">제출 버튼이 필요 없습니다. 값을 바꾸면 즉시 계산됩니다. 체지방률로 제지방량(FFM)을 산출합니다.</div>
      </div>

      <div class="row">
        <div class="section-title">
          <div>
            <div class="kicker">2) 권장 범위 & 미세조정</div>
            <h3 style="margin:4px 0 0">g/kg 슬라이더로 미세 조정</h3>
          </div>
          <span class="pill">문헌 기반 범위 · 기본값은 중간값</span>
        </div>
        <div class="grid cols-2">
          <div class="row">
            <label>단백질 (g/FFM·kg) <small id="pRange"></small></label>
            <input type="range" id="pSlider" min="2.3" max="3.1" step="0.1" />
            <div class="out"><small>선택: <span id="pSel"></span> g/FFM·kg</small><b id="pOut">— g</b></div>
          </div>
          <div class="row">
            <label>탄수화물 (g/BW·kg) <small id="cRange"></small></label>
            <input type="range" id="cSlider" min="3.5" max="10" step="0.1" />
            <div class="out"><small>선택: <span id="cSel"></span> g/BW·kg</small><b id="cOut">— g</b></div>
          </div>
          <div class="row">
            <label>지방 (g/BW·kg) <small id="fRange"></small></label>
            <input type="range" id="fSlider" min="0.2" max="0.8" step="0.05" />
            <div class="out"><small>선택: <span id="fSel"></span> g/BW·kg</small><b id="fOut">— g</b></div>
          </div>
          <div class="row">
            <label>일일 수분 (mL/kg) <small id="wRange"></small></label>
            <input type="range" id="wSlider" min="30" max="55" step="1" />
            <div class="out"><small>선택: <span id="wSel"></span> mL/kg</small><b id="wOut">— L/일</b></div>
          </div>
          <div class="row">
            <label>나트륨 (mg/일) <small id="sRange"></small></label>
            <input type="range" id="sSlider" min="2500" max="5500" step="50" />
            <div class="out"><small>선택: <span id="sSel"></span> mg/일</small><b id="sOut">— mg</b></div>
          </div>
          <div class="row">
            <label>운동 중/후 전해질 (나트륨 mg/L)</label>
            <input type="range" id="sDrink" min="460" max="1150" step="10" />
            <div class="out"><small>권장: 460~1150 mg/L</small><b id="sDrinkOut">— mg/L</b></div>
          </div>
        </div>
        <div class="note tiny">* 단백질은 FFM 기준(g/FFM·kg), 탄수/지방은 체중 기준(g/BW·kg)으로 산출합니다. 수분은 체중 mL/kg로 산출.
          모드에 따라 각 슬라이더 범위가 자동으로 세팅됩니다.</div>
      </div>

      <div class="row">
        <div class="section-title">
          <div>
            <div class="kicker">3) 출력</div>
            <h3 style="margin:4px 0 0">일일 섭취 g·kcal / 수분·나트륨</h3>
          </div>
          <span class="pill">칼로리 환산: P4 · C4 · F9</span>
        </div>
        <div class="grid cols-2">
          <div class="panel" style="background:#0f1116">
            <canvas id="macroPie" height="260"></canvas>
          </div>
          <div class="panel" style="background:#0f1116">
            <canvas id="macroBars" height="260"></canvas>
          </div>
        </div>
        <div class="grid cols-2">
          <div class="out"><small>단백질</small><b id="pG">— g (— kcal)</b></div>
          <div class="out"><small>탄수화물</small><b id="cG">— g (— kcal)</b></div>
          <div class="out"><small>지방</small><b id="fG">— g (— kcal)</b></div>
          <div class="out"><small>총 칼로리</small><b id="kcal">— kcal</b></div>
          <div class="out"><small>물 섭취</small><b id="water">— L/일</b></div>
          <div class="out"><small>나트륨</small><b id="sodium">— mg/일</b></div>
        </div>
      </div>

      <div class="row">
        <div class="section-title">
          <div>
            <div class="kicker">4) 글리코겐 추정 (선택)</div>
            <h3 style="margin:4px 0 0">저장량·수분결합 가정치</h3>
          </div>
          <span class="pill">연구기반 근사 · 개인 편차 큼</span>
        </div>
        <div class="grid cols-2">
          <div class="row">
            <label>근육 글리코겐 저장량 (g/FFM·kg)</label>
            <input type="range" id="glycPerKg" min="10" max="15" step="0.5" />
            <div class="out"><small>선택: <span id="glycPerKgSel"></span> g/FFM·kg</small><b id="glycCap">— g (추정 최대)</b></div>
          </div>
          <div class="row">
            <label>글리코겐-수분 결합 비 (g 물 / g 글리코겐)</label>
            <input type="range" id="waterRatio" min="2.7" max="4.0" step="0.1" />
            <div class="out"><small>선택: <span id="waterRatioSel"></span> g/g</small><b id="glycWater">— L (추정 수분 동반)</b></div>
          </div>
        </div>
        <div class="row">
          <label>오늘 탄수화물로 채워지는 비율</label>
          <div class="progress"><span id="glycFill"></span></div>
          <div class="tiny" id="glycNote">—</div>
        </div>
      </div>

      <div class="row">
        <div class="section-title">
          <div>
            <div class="kicker">도구</div>
            <h3 style="margin:4px 0 0">프리셋 · 저장 · 공유</h3>
          </div>
          <span class="pill">로컬 저장됨</span>
        </div>
        <div class="btns">
          <button id="presetLoose">프리셋: 보수적</button>
          <button id="presetStd" class="primary">프리셋: 표준</button>
          <button id="presetAgg">프리셋: 공격적</button>
          <button id="save">현재 값 저장</button>
          <button id="reset">초기화</button>
        </div>
        <div class="tiny">* 프리셋은 모드별 슬라이더를 일괄 조정합니다. 저장은 브라우저 로컬스토리지에만 보관됩니다.</div>
      </div>

      <div class="row">
        <div class="hr"></div>
        <div class="footnote">
          <b>주의:</b> 본 계산기는 최신 스포츠영양 가이드라인을 바탕으로 한 범위 추천입니다. 개인의 의학적 상태·약물·도핑 규정·소화기 민감도에 따라 조정해야 합니다. 대회 당일 과도한 수분/나트륨 조작은 퍼포먼스와 외형을 해칠 수 있습니다. 
        </div>
      </div>

    </div>
  </div>

  <!-- Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    // --- Utility ---
    const $ = (id) => document.getElementById(id);

    // Preset ranges per mode (literature-informed). Protein uses per-kg FFM; carbs & fat use per-kg BW.
    const RANGES = {
      refeed: {
        p: [2.5, 3.1, 2.7],      // g/kg FFM
        c: [3.5, 7.0, 5.0],      // g/kg BW
        f: [0.3, 0.6, 0.4],      // g/kg BW
        w: [35, 50, 42],         // mL/kg/day
        s: [3000, 5000, 4000],   // mg/day
        sDrink: 700              // mg/L around training
      },
      depletion: {
        p: [2.7, 3.1, 2.9],
        c: [0.5, 1.0, 0.7],
        f: [0.5, 0.8, 0.6],
        w: [35, 50, 40],
        s: [2500, 4000, 3000],
        sDrink: 700
      },
      supercomp: {
        p: [2.3, 2.7, 2.5],
        c: [7.0, 10.0, 8.5],
        f: [0.2, 0.5, 0.3],
        w: [40, 55, 46],
        s: [3500, 5500, 4500],
        sDrink: 700
      },
      showday: {
        p: [2.5, 3.0, 2.7],
        c: [1.0, 3.0, 2.0], // default will be tweaked by division
        f: [0.2, 0.5, 0.3],
        w: [30, 45, 36],
        s: [2500, 3500, 3000],
        sDrink: 600
      }
    };

    // State
    const state = {
      bw: Number($("bw").value),
      bf: Number($("bf").value),
      mode: $("mode").value,
      division: "sportsmodel",
      glycPerKg: 12,    // g glycogen per kg FFM (tunable)
      waterRatio: 3.0   // g water per g glycogen (tunable)
    };

    // Elements
    const els = {
      bwLive: $("bwLive"), bfLive: $("bfLive"),
      pSlider: $("pSlider"), cSlider: $("cSlider"), fSlider: $("fSlider"), wSlider: $("wSlider"), sSlider: $("sSlider"), sDrink: $("sDrink"),
      pRange: $("pRange"), cRange: $("cRange"), fRange: $("fRange"), wRange: $("wRange"), sRange: $("sRange"),
      pSel: $("pSel"), cSel: $("cSel"), fSel: $("fSel"), wSel: $("wSel"),
      pOut: $("pOut"), cOut: $("cOut"), fOut: $("fOut"), wOut: $("wOut"), sOut: $("sOut"), sDrinkOut: $("sDrinkOut"), sSel: $("sSel"),
      pG: $("pG"), cG: $("cG"), fG: $("fG"), kcal: $("kcal"), water: $("water"), sodium: $("sodium"),
      glycPerKg: $("glycPerKg"), glycPerKgSel: $("glycPerKgSel"), glycCap: $("glycCap"),
      waterRatio: $("waterRatio"), waterRatioSel: $("waterRatioSel"), glycWater: $("glycWater"), glycFill: $("glycFill"), glycNote: $("glycNote"),
      mode: $("mode"), division: $("division"), divisionWrap: $("divisionWrap"),
      presetLoose: $("presetLoose"), presetStd: $("presetStd"), presetAgg: $("presetAgg"), save: $("save"), reset: $("reset")
    };

    // Charts init
    let pieChart, barChart;
    function initCharts(){
      const pieCtx = $("macroPie").getContext('2d');
      const barCtx = $("macroBars").getContext('2d');
      pieChart = new Chart(pieCtx, {
        type: 'doughnut',
        data: { labels: ['단백질 kcal', '탄수 kcal', '지방 kcal'], datasets: [{ data: [1,1,1] }] },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: { legend: { position: 'bottom', labels: { color: '#cfd3da' } } },
          cutout: '55%'
        }
      });
      barChart = new Chart(barCtx, {
        type: 'bar',
        data: { labels: ['단백질 (g)', '탄수 (g)', '지방 (g)'], datasets: [{ data: [0,0,0] }] },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: { legend: { display:false } },
          scales: { x: { ticks: { color:'#cfd3da' } }, y: { ticks: { color:'#cfd3da' }, beginAtZero: true } }
        }
      });
    }

    // Helpers
    function setRangeText(){
      const r = RANGES[state.mode];
      els.pRange.textContent = `권장 ${r.p[0].toFixed(1)}~${r.p[1].toFixed(1)}`;
      els.cRange.textContent = `권장 ${r.c[0].toFixed(1)}~${r.c[1].toFixed(1)}`;
      els.fRange.textContent = `권장 ${r.f[0].toFixed(2)}~${r.f[1].toFixed(2)}`;
      els.wRange.textContent = `권장 ${r.w[0]}~${r.w[1]}`;
      els.sRange.textContent = `권장 ${r.s[0]}~${r.s[1]}`;
    }

    function applyModeDefaults(){
      const r = RANGES[state.mode];
      // Show-day division tweak for carbs default
      let cDefault = r.c[2];
      if(state.mode === 'showday'){
        cDefault = (state.division === 'bodybuilding') ? 2.5 : 1.5;
      }
      els.pSlider.min = r.p[0]; els.pSlider.max = r.p[1]; els.pSlider.value = r.p[2];
      els.cSlider.min = r.c[0]; els.cSlider.max = r.c[1]; els.cSlider.value = cDefault;
      els.fSlider.min = r.f[0]; els.fSlider.max = r.f[1]; els.fSlider.value = r.f[2];
      els.wSlider.min = r.w[0]; els.wSlider.max = r.w[1]; els.wSlider.value = r.w[2];
      els.sSlider.min = r.s[0]; els.sSlider.max = r.s[1]; els.sSlider.value = r.s[2];
      els.sDrink.value = r.sDrink;
      setRangeText();
    }

    function fmt(n, unit=""){ return `${n.toLocaleString(undefined,{maximumFractionDigits: (unit==='g'||unit==='kcal')?0:1})} ${unit}`.trim(); }

    function compute(){
      // Read inputs
      state.bw = Number($("bw").value) || 0;
      state.bf = Number($("bf").value) || 0;
      const ffm = state.bw * (1 - state.bf/100);
      const pPer = Number(els.pSlider.value);
      const cPer = Number(els.cSlider.value);
      const fPer = Number(els.fSlider.value);
      const wPer = Number(els.wSlider.value);
      const sDay = Number(els.sSlider.value);
      const sDrink = Number(els.sDrink.value);

      // Outputs (grams)
      const pG = Math.round(pPer * ffm);
      const cG = Math.round(cPer * state.bw);
      const fG = Math.round(fPer * state.bw);

      const kcal = Math.round(pG*4 + cG*4 + fG*9);
      const waterL = (wPer * state.bw) / 1000; // L/day

      // Update text
      els.bwLive.textContent = fmt(state.bw,'kg');
      els.bfLive.textContent = `${state.bf.toFixed(1)}%`;

      els.pSel.textContent = `${pPer.toFixed(1)}`;
      els.cSel.textContent = `${cPer.toFixed(1)}`;
      els.fSel.textContent = `${fPer.toFixed(2)}`;
      els.wSel.textContent = `${wPer.toFixed(0)}`;

      els.pOut.textContent = fmt(pG,'g');
      els.cOut.textContent = fmt(cG,'g');
      els.fOut.textContent = fmt(fG,'g');
      els.wOut.textContent = fmt(waterL,'L/일');
      els.sDrinkOut.textContent = fmt(sDrink,'mg/L');
      els.sOut.textContent = fmt(sDay,'mg');

      els.pG.textContent = `${fmt(pG,'g')} (${fmt(pG*4,'kcal')})`;
      els.cG.textContent = `${fmt(cG,'g')} (${fmt(cG*4,'kcal')})`;
      els.fG.textContent = `${fmt(fG,'g')} (${fmt(fG*9,'kcal')})`;
      els.kcal.textContent = fmt(kcal,'kcal');
      els.water.textContent = fmt(waterL,'L/일');
      els.sodium.textContent = fmt(sDay,'mg/일');

      // Charts
      const pieData = [pG*4, cG*4, fG*9];
      pieChart.data.datasets[0].data = pieData;
      pieChart.update('none');

      barChart.data.datasets[0].data = [pG, cG, fG];
      barChart.update('none');

      // Glycogen estimate
      const glycPerKg = Number(els.glycPerKg.value);
      const waterRatio = Number(els.waterRatio.value);
      const glycCap = Math.round(glycPerKg * ffm + 100); // + ~100g liver reserve (rough)
      const fill = Math.max(0, Math.min(1, cG / glycCap));
      const glycWaterL = ((cG * waterRatio) / 1000);

      els.glycPerKgSel.textContent = `${glycPerKg.toFixed(1)}`;
      els.waterRatioSel.textContent = `${waterRatio.toFixed(1)}`;
      els.glycCap.textContent = fmt(glycCap,'g');
      els.glycWater.textContent = fmt(glycWaterL,'L');
      els.glycFill.style.width = `${(fill*100).toFixed(0)}%`;
      els.glycNote.textContent = `탄수 ${fmt(cG,'g')} → 글리코겐 채움 추정 ${Math.round(fill*100)}% (최대치 ${fmt(glycCap,'g')} 기준).`;

      // Persist quick
      try {
        localStorage.setItem('peakCalc:v1', JSON.stringify({
          bw: state.bw, bf: state.bf, mode: state.mode, division: state.division,
          pPer, cPer, fPer, wPer, sDay, sDrink, glycPerKg, waterRatio
        }));
      } catch(e) {}
    }

    function loadSaved(){
      try {
        const raw = localStorage.getItem('peakCalc:v1');
        if(!raw) return false;
        const d = JSON.parse(raw);
        $("bw").value = d.bw; $("bf").value = d.bf; state.mode = d.mode || 'refeed'; state.division = d.division || 'sportsmodel';
        $("mode").value = state.mode; $("division").value = state.division;
        applyModeDefaults();
        els.pSlider.value = d.pPer; els.cSlider.value = d.cPer; els.fSlider.value = d.fPer; els.wSlider.value = d.wPer; els.sSlider.value = d.sDay; els.sDrink.value = d.sDrink;
        els.glycPerKg.value = d.glycPerKg || 12; els.waterRatio.value = d.waterRatio || 3.0;
        return true;
      } catch(e) { return false; }
    }

    function handleModeChange(){
      state.mode = els.mode.value;
      // Toggle division for show day
      els.divisionWrap.style.display = (state.mode === 'showday') ? 'block' : 'none';
      applyModeDefaults();
      compute();
    }

    function handleDivisionChange(){
      state.division = els.division.value;
      if(state.mode === 'showday'){
        // tweak carb default when switching division
        const r = RANGES.showday;
        els.cSlider.value = (state.division === 'bodybuilding') ? 2.5 : 1.5;
      }
      compute();
    }

    function applyPreset(name){
      const m = state.mode;
      const r = RANGES[m];
      if(name==='loose'){
        els.pSlider.value = r.p[0]; els.cSlider.value = r.c[0]; els.fSlider.value = r.f[0]; els.wSlider.value = r.w[0]; els.sSlider.value = r.s[0];
      } else if(name==='std'){
        els.pSlider.value = r.p[2]; els.cSlider.value = (m==='showday'? (state.division==='bodybuilding'?2.5:1.5): r.c[2]); els.fSlider.value = r.f[2]; els.wSlider.value = r.w[2]; els.sSlider.value = r.s[2];
      } else if(name==='agg'){
        els.pSlider.value = r.p[1]; els.cSlider.value = r.c[1]; els.fSlider.value = r.f[1]; els.wSlider.value = r.w[1]; els.sSlider.value = r.s[1];
      }
      compute();
    }

    // Events
    $("bw").addEventListener('input', compute);
    $("bf").addEventListener('input', compute);
    els.mode.addEventListener('change', handleModeChange);
    els.division.addEventListener('change', handleDivisionChange);
    [els.pSlider, els.cSlider, els.fSlider, els.wSlider, els.sSlider, els.sDrink, els.glycPerKg, els.waterRatio].forEach(el=>{
      el.addEventListener('input', compute);
    });

    els.presetLoose.addEventListener('click', ()=>applyPreset('loose'));
    els.presetStd.addEventListener('click', ()=>applyPreset('std'));
    els.presetAgg.addEventListener('click', ()=>applyPreset('agg'));

    els.save.addEventListener('click', ()=>{ try{ localStorage.setItem('peakCalc:snapshot:'+Date.now(), localStorage.getItem('peakCalc:v1')); alert('현재 설정이 저장되었습니다 (이 기기 전용).'); }catch(e){} });
    els.reset.addEventListener('click', ()=>{ localStorage.removeItem('peakCalc:v1'); applyModeDefaults(); compute(); });

    // Init
    initCharts();
    if(!loadSaved()){
      applyModeDefaults();
    }
    // Defaults for glycogen panel
    els.glycPerKg.value = state.glycPerKg; els.waterRatio.value = state.waterRatio;
    compute();
  </script>
</body>
</html>
